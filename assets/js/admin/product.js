var AdminProduct,bind=function(t,e){return function(){return t.apply(e,arguments)}},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1};AdminProduct=function(){function t(t){this.params=t,this.processInheritedAttributes=bind(this.processInheritedAttributes,this),this.getInherittedAttributes=bind(this.getInherittedAttributes,this),this.addAttachment=bind(this.addAttachment,this),this.initAttachments=bind(this.initAttachments,this),this.updateAttachments=bind(this.updateAttachments,this),this.removeAttribute=bind(this.removeAttribute,this),this.updateAttribute=bind(this.updateAttribute,this),this.addAttribute=bind(this.addAttribute,this),this.changeProductType=bind(this.changeProductType,this),jQuery("#add-attribute").on("click",this.addAttribute),jQuery("#new-attribute").on("change",function(t){var e;return e=jQuery("#new-attribute-label"),"-1"===jQuery(t.target).val()?(e.closest(".form-group").css("display","inline-block"),e.fadeIn()):e.fadeOut()}),jQuery("#product-attributes").on("click",".show-variation",function(t){var e;return e=jQuery(t.target),jQuery(".list-group-item-text",e.closest("li")).slideToggle(function(){return jQuery("span",e).toggleClass("glyphicon-collapse-down").toggleClass("glyphicon-collapse-up")})}),jQuery("#product-attributes").on("change","input, select",this.updateAttribute).on("click",".remove-attribute",this.removeAttribute).sortable({axis:"y"}),jQuery("#product-type").on("change",this.changeProductType),jQuery(".jigoshop_product_data a").on("click",function(t){return t.preventDefault(),jQuery(this).tab("show")}),jQuery("#stock-manage").on("change",function(){return jQuery(this).is(":checked")?(jQuery(".stock-status_field").slideUp(),jQuery(".stock-status").slideDown()):(jQuery(".stock-status_field").slideDown(),jQuery(".stock-status").slideUp())}),jQuery(".stock-status_field .not-active").show(),jQuery("#sales-enabled").on("change",function(){return jQuery(this).is(":checked")?jQuery(".schedule").slideDown():jQuery(".schedule").slideUp()}),jQuery("#is_taxable").on("change",function(){return jQuery(this).is(":checked")?jQuery(".tax_classes_field").slideDown():jQuery(".tax_classes_field").slideUp()}),jQuery(".tax_classes_field .not-active").show(),jQuery("#sales-from").datepicker({todayBtn:"linked",autoclose:!0}),jQuery("#sales-to").datepicker({todayBtn:"linked",autoclose:!0}),jQuery(".add-product-attachments").on("click",this.updateAttachments),jQuery(document).ready(this.initAttachments),jigoshop.ajaxSearch(jQuery("#product_cross_sells"),{action:"jigoshop.admin.product.find",only_parent:!0}),jigoshop.ajaxSearch(jQuery("#product_up_sells"),{action:"jigoshop.admin.product.find",only_parent:!0}),jQuery("#add-inherited-attributes").click(this.getInherittedAttributes)}return t.prototype.params={i18n:{saved:"",confirm_remove:"",attribute_removed:"",invalid_attribute:"",attribute_without_label:""},menu:{},attachments:{}},t.prototype.wpMedia=!1,t.prototype.removedAttributes=[],t.prototype.changeProductType=function(t){var e,r,i,a,s;e=jQuery(t.target),a=e.val(),jQuery(".jigoshop_product_data li").hide(),r=this.params.menu;for(i in r)hasProp.call(r,i)&&(s=r[i],(s===!0||indexOf.call(s,a)>=0)&&jQuery(".jigoshop_product_data li."+i).show());return jQuery(".jigoshop_product_data li:first a").tab("show"),jQuery.ajax({url:jigoshop.getAjaxUrl(),type:"post",dataType:"json",data:{action:"jigoshop.admin.product.update_type",product_id:e.closest(".jigoshop").data("id"),type:a}}).done(function(t){return function(e){return null!=e.success&&e.success?jigoshop.addMessage("success",t.params.i18n.saved,2e3):jigoshop.addMessage("danger",e.error,6e3)}}(this))},t.prototype.addAttribute=function(t){var e,r,i,a,s;return t.preventDefault(),i=jQuery("#product-attributes"),e=jQuery("#new-attribute"),r=jQuery("#new-attribute-label"),s=parseInt(e.val()),a=r.val(),0>s&&-1!==s?void jigoshop.addMessage("warning",this.params.i18n.invalid_attribute):-1===s&&0===a.length?void jigoshop.addMessage("danger",this.params.i18n.attribute_without_label,6e3):(e.select2("val",""),r.val("").slideUp(),s>0&&jQuery("option[value="+s+"]",e).attr("disabled","disabled"),jQuery.ajax({url:jigoshop.getAjaxUrl(),type:"post",dataType:"json",data:{action:"jigoshop.admin.product.save_attribute",product_id:i.closest(".jigoshop").data("id"),attribute_id:s,attribute_label:a}}).done(function(t){return null!=t.success&&t.success?(jQuery(t.html).hide().appendTo(i).slideDown(),i.trigger("add-attribute")):jigoshop.addMessage("danger",t.error,6e3)}))},t.prototype.updateAttribute=function(t){var e,r,i,a,s,o,u,n,d,c,p;for(e=jQuery("#product-attributes"),r=jQuery(t.target).closest("li.list-group-item"),o=jQuery(".values input[type=checkbox]:checked",r).toArray(),o.length?s=o.reduce(function(t,e){return e.value+"|"+t},""):(s=jQuery(".values select",r).val(),void 0===s&&(s=jQuery(".values input",r).val())),i=function(t){return"checkbox"===t.type||"radio"===t.type?t.checked:t.value},d={},c=jQuery(".options input.attribute-options",r).toArray(),a=0,u=c.length;u>a;a++)n=c[a],p=/(?:^|\s)product\[attributes]\[\d+]\[(.*?)](?:\s|$)/g.exec(n.name),d[p[1]]=i(n);return jQuery.ajax({url:jigoshop.getAjaxUrl(),type:"post",dataType:"json",data:{action:"jigoshop.admin.product.save_attribute",product_id:e.closest(".jigoshop").data("id"),attribute_id:r.data("id"),value:s,options:d}}).done(function(t){return function(e){return null!=e.success&&e.success?jigoshop.addMessage("success",t.params.i18n.saved,2e3):jigoshop.addMessage("danger",e.error,6e3)}}(this))},t.prototype.removeAttribute=function(t){var e;return t.preventDefault(),confirm(this.params.i18n.confirm_remove)?(e=jQuery(t.target).closest("li"),this.removedAttributes.push(e.data("id")),jQuery("option[value="+e.data("id")+"]",jQuery("#new-attribute")).removeAttr("disabled"),jQuery.ajax({url:jigoshop.getAjaxUrl(),type:"post",dataType:"json",data:{action:"jigoshop.admin.product.remove_attribute",product_id:e.closest(".jigoshop").data("id"),attribute_id:e.data("id")}}).done(function(t){return function(r){return null!=r.success&&r.success?(e.slideUp(function(){return e.remove()}),jigoshop.addMessage("success",t.params.i18n.attribute_removed,2e3)):jigoshop.addMessage("danger",r.error,6e3)}}(this))):void 0},t.prototype.updateAttachments=function(t){var e,r;return t.preventDefault(),e=jQuery(t.target).data("type"),r?void this.wpMedia.open():(this.wpMedia=wp.media({states:[new wp.media.controller.Library({filterable:"all",multiple:!0})]}),r=this.wpMedia,this.wpMedia.on("select",function(t){return function(){var i,a;return a=r.state().get("selection"),i=jQuery.map(jQuery('input[name="product[attachments]['+e+'][]"]'),function(t){return parseInt(jQuery(t).val())}),a.map(function(r){var a;return r=r.toJSON(),null!=r.id?("image"===e?a={template_name:"product-gallery",insert_before:".empty-gallery",attachment_class:".gallery-image"}:"datafile"===e&&(a={template_name:"product-downloads",insert_before:".empty-downloads",attachment_class:".downloads-file"}),t.addAttachment(r,i,a)):void 0})}}(this)),r.open())},t.prototype.initAttachments=function(){var t,e,r,i,a,s;for(i=this.params.attachments,a=[],e=0,r=i.length;r>e;e++)t=i[e],"image"===t.type?(s=wp.template("product-gallery"),jQuery(".empty-gallery").before(s(t)),a.push(this.addHooks("",jQuery(".gallery-image").last()))):"datafile"===t.type?(s=wp.template("product-downloads"),jQuery(".empty-downloads").before(s(t)),a.push(this.addHooks("",jQuery(".downloads-file").last()))):a.push(void 0);return a},t.prototype.addHooks=function(t,e){var r;return r=jQuery(e).find(".delete"),jQuery(e).hover(function(){return r.show()},function(){return r.hide()}),r.click(function(){return jQuery(e).remove()})},t.prototype.addAttachment=function(t,e,r){var i,a;return t.id&&-1===jQuery.inArray(t.id,e)?(a=wp.template(r.template_name),i=a({id:t.id,url:t.sizes&&t.sizes.thumbnail?t.sizes.thumbnail.url:t.url,title:t.title}),jQuery(r.insert_before).before(i),this.addHooks("",jQuery(r.attachment_class).last())):void 0},t.prototype.getInherittedAttributes=function(t){var e;return e=[],jQuery("#product_categorychecklist").find('input[type="checkbox"]').each(function(t,r){jQuery(r).is(":checked")&&e.push(jQuery(r).val())}),jQuery.post(ajaxurl,{action:"jigoshop.admin.product.get_inherited_attributes",categories:e,productId:jQuery("#product-attributes").closest(".jigoshop").data("id")},this.processInheritedAttributes,"json")},t.prototype.processInheritedAttributes=function(t){var e,r,i,a,s,o,u,n,d;if(t.success){for(d=[],i=s=0,u=t.attributes.length;u>=0?u>s:s>u;i=u>=0?++s:--s){for(r=0,e=0,a=o=0,n=this.removedAttributes.length;n>=0?n>o:o>n;a=n>=0?++o:--o)if(this.removedAttributes[a]===t.attributes[i].id){r=1;break}r||(jQuery("#product-attributes").find("li").each(function(r,a){jQuery(a).data("id")===t.attributes[i].id&&(e=1)}),e||d.push(jQuery("#product-attributes").append(t.attributes[i].render)))}return d}},t}(),jQuery(function(){return new AdminProduct(jigoshop_admin_product)});